# ANN-CLI

A command-line interface for training, testing, and predicting with Artificial Neural Networks.

## Building

```bash
mkdir build && cd build
cmake ..
make
```

## Usage

```bash
# Training
ANN-CLI --config <config_file> --mode train [options]

# Running predict
ANN-CLI --config <model_file> --mode predict --input <input_file> [options]

# Testing/evaluation
ANN-CLI --config <model_file> --mode test --samples <samples_file> [options]
```

### Options

| Option | Short | Description |
|--------|-------|-------------|
| `--config` | `-c` | Path to JSON configuration/model file (required) |
| `--mode` | `-m` | Mode: `train`, `predict`, or `test` (overrides config file) |
| `--device` | `-d` | Device: `cpu` or `gpu` (overrides config file) |
| `--samples` | `-s` | Path to JSON file with samples (for train/test modes) |
| `--idx-data` | | Path to IDX3 data file (alternative to `--samples`) |
| `--idx-labels` | | Path to IDX1 labels file (requires `--idx-data`) |
| `--input` | `-i` | Path to JSON file with input values (predict mode) |
| `--output` | `-o` | Output file for saving trained model (train mode) |
| `--help` | `-h` | Show help message |

### Modes

- **train**: Train a neural network using `--config` and samples, outputs a trained model file.
- **predict**: Run predict using `--config` (trained model) with a single input.
- **test**: Evaluate a trained model (`--config`) on test samples and report the loss (MSE).

## JSON File Formats

### Configuration File (Train Mode)

The configuration file defines the neural network architecture and training parameters.

```json
{
  "mode": "train",
  "device": "cpu",
  "layersConfig": [
    { "numNeurons": 784, "actvFunc": "none" },
    { "numNeurons": 128, "actvFunc": "relu" },
    { "numNeurons": 64, "actvFunc": "relu" },
    { "numNeurons": 10, "actvFunc": "sigmoid" }
  ],
  "trainingConfig": {
    "numEpochs": 100,
    "learningRate": 0.01,
    "numThreads": 0
  }
}
```

### Configuration File (Predict Mode)

For running predict with a trained model:

```json
{
  "mode": "predict",
  "device": "gpu",
  "layersConfig": [
    { "numNeurons": 784, "actvFunc": "none" },
    { "numNeurons": 128, "actvFunc": "relu" },
    { "numNeurons": 64, "actvFunc": "relu" },
    { "numNeurons": 10, "actvFunc": "sigmoid" }
  ],
  "parameters": {
    "weights": [...],
    "biases": [...]
  }
}
```

### Configuration File (Test Mode)

For evaluating a trained model:

```json
{
  "mode": "test",
  "device": "cpu",
  "layersConfig": [
    { "numNeurons": 784, "actvFunc": "none" },
    { "numNeurons": 128, "actvFunc": "relu" },
    { "numNeurons": 64, "actvFunc": "relu" },
    { "numNeurons": 10, "actvFunc": "sigmoid" }
  ],
  "parameters": {
    "weights": [...],
    "biases": [...]
  }
}
```

#### Top-Level Configuration

- `mode`: Operation mode (optional, default: `predict`) — *can be overridden by `--mode`*
  - `train` - Train the neural network
  - `predict` - Run predict
  - `test` - Evaluate model performance
- `device`: Execution device (optional, default: `cpu`) — *can be overridden by `--device`*
  - `cpu` - Use CPU for computation
  - `gpu` - Use GPU via OpenCL

#### Layers Configuration

- `numNeurons`: Number of neurons in the layer
- `actvFunc`: Activation function. Available options:
  - `none` - No activation (use for input layer)
  - `relu` - Rectified Linear Unit
  - `sigmoid` - Sigmoid function
  - `tanh` - Hyperbolic tangent

#### Training Configuration (required for train mode)

- `numEpochs`: Number of training epochs
- `learningRate`: Learning rate for gradient descent
- `numThreads`: Number of CPU threads to use for training (default: 0 = use all available cores). Set to 1 for single-threaded execution.

### Model File (output from training)

The trained model file contains the network architecture and learned weights:

```json
{
  "layersConfig": [...],
  "parameters": {
    "weights": [...],
    "biases": [...]
  }
}
```

This file is generated by `--mode train` and can be used directly with `--config` for `--mode predict` and `--mode test`.

### Samples File (JSON format)

Training samples with input/output pairs:

```json
{
  "samples": [
    {
      "input": [0.0, 0.5, 1.0, 0.75],
      "output": [1.0, 0.0]
    },
    {
      "input": [1.0, 0.25, 0.0, 0.5],
      "output": [0.0, 1.0]
    }
  ]
}
```

### Input File (for predict mode)

```json
{
  "input": [0.0, 0.5, 1.0, 0.75]
}
```

## IDX File Format

As an alternative to JSON samples, you can use IDX format files (commonly used for MNIST and similar datasets):

- **IDX3**: Multi-dimensional data (e.g., images)
- **IDX1**: Labels

The data is automatically normalized to 0-1 range and labels are one-hot encoded.

## Examples

### Training with JSON samples

```bash
ANN-CLI --config model.json --mode train --samples training_data.json --output trained_model.json
```

### Training with IDX files

```bash
ANN-CLI --config model.json --mode train --idx-data train-images-idx3-ubyte --idx-labels train-labels-idx1-ubyte --output trained_model.json
```

### Training on GPU

```bash
ANN-CLI --mode train --config model.json --device gpu --samples training_data.json
```

### Running predict

```bash
ANN-CLI --config trained_model.json --mode predict --input test_input.json
```

### Running predict on GPU

```bash
ANN-CLI --config trained_model.json --mode predict --device gpu --input test_input.json
```

### Testing a model with JSON samples

```bash
ANN-CLI --config trained_model.json --mode test --samples test_data.json
```

### Testing a model with IDX files

```bash
ANN-CLI --config trained_model.json --mode test --idx-data t10k-images-idx3-ubyte --idx-labels t10k-labels-idx1-ubyte
```

### Testing on GPU

```bash
ANN-CLI --config trained_model.json --mode test --device gpu --samples test_data.json
```

## License

See [LICENSE.md](LICENSE.md) for details.

